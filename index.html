<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astronaut in Space</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="loading">Loading...</div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';

        // Scene 설정
        const scene = new THREE.Scene();
        
        // 카메라
        const camera = new THREE.PerspectiveCamera(
            60,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.z = 10;

        // 렌더러
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // 우주 배경 (별)
        function createStars() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            
            for (let i = 0; i < 5000; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                sizeAttenuation: true
            });
            
            return new THREE.Points(geometry, material);
        }
        
        scene.add(createStars());

        // 조명
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        const backLight = new THREE.DirectionalLight(0x4488ff, 0.3);
        backLight.position.set(-5, -5, -5);
        scene.add(backLight);

        // 텍스처 로드
        const textureLoader = new THREE.TextureLoader();
        const baseColorMap = textureLoader.load('./Astronauts_BaseColor.jpg');
        const normalMap = textureLoader.load('./Astronauts_Normal.jpg');

        // 색공간 설정
        baseColorMap.colorSpace = THREE.SRGBColorSpace;

        let astronaut = null;

        // MTL + OBJ 로드
        const mtlLoader = new MTLLoader();
        mtlLoader.load('./Astronaut.mtl', (materials) => {
            materials.preload();
            
            const objLoader = new OBJLoader();
            objLoader.setMaterials(materials);
            objLoader.load(
                './Astronaut.obj',
                (object) => {
                    astronaut = object;
                    
                    // 머티리얼에 텍스처 적용
                    astronaut.traverse((child) => {
                        if (child.isMesh) {
                            child.material = new THREE.MeshStandardMaterial({
                                map: baseColorMap,
                                normalMap: normalMap,
                                metalness: 0.1,
                                roughness: 0.8
                            });
                        }
                    });
                    
                    // 모델 위치/크기 조정 (필요에 따라 수정)
                    astronaut.position.set(0, -3.0, 0);
                    astronaut.scale.set(0.5, 0.5, 0.5);
                    
                    scene.add(astronaut);
                    
                    // 로딩 텍스트 제거
                    document.getElementById('loading').style.display = 'none';
                },
                (xhr) => {
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                (error) => {
                    console.error('OBJ 로드 에러:', error);
                }
            );
        });

        // 윈도우 리사이즈 대응
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 애니메이션 루프
        const clock = new THREE.Clock();
        
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            
            // 우주인 Y축 회전
            if (astronaut) {
                astronaut.rotation.y += delta * 0.5; // 회전 속도 조절
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
    </script>
</body>
</html>